{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile with personal and financial preferences.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "preferredCurrency": {
          "type": "string",
          "description": "User's preferred currency for financial data (e.g., USD, EUR)."
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName"
      ]
    },
    "Income": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Income",
      "type": "object",
      "description": "Represents a single income entry for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the income entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Income)"
        },
        "source": {
          "type": "string",
          "description": "Source of the income (e.g., salary, investment)."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the income."
        },
        "date": {
          "type": "string",
          "description": "Date of the income.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "source",
        "amount",
        "date"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents a single expense entry for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Expense)"
        },
        "category": {
          "type": "string",
          "description": "Category of the expense (e.g., housing, food, transportation)."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the expense."
        },
        "date": {
          "type": "string",
          "description": "Date of the expense.",
          "format": "date-time"
        },
        "notes": {
          "type": "string",
          "description": "Additional notes about the expense."
        }
      },
      "required": [
        "id",
        "userId",
        "category",
        "amount",
        "date"
      ]
    },
    "BudgetAlert": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "BudgetAlert",
      "type": "object",
      "description": "Represents a budget alert for a specific category.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the budget alert."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N BudgetAlert)"
        },
        "category": {
          "type": "string",
          "description": "Category for which the alert is set (e.g., food, transportation)."
        },
        "threshold": {
          "type": "number",
          "description": "Threshold amount for the alert."
        },
        "frequency": {
          "type": "string",
          "description": "Frequency of the alert (e.g., daily, weekly, monthly)."
        },
        "lastTriggered": {
          "type": "string",
          "description": "Timestamp of the last time the alert was triggered.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "category",
        "threshold",
        "frequency"
      ]
    },
    "SavingSuggestion": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SavingSuggestion",
      "type": "object",
      "description": "Represents a personalized saving suggestion.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the saving suggestion."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N SavingSuggestion)"
        },
        "suggestionText": {
          "type": "string",
          "description": "Text of the saving suggestion."
        },
        "potentialSavings": {
          "type": "number",
          "description": "Estimated potential savings from the suggestion."
        },
        "category": {
          "type": "string",
          "description": "Category related to the saving suggestion (e.g., food, transportation)."
        }
      },
      "required": [
        "id",
        "userId",
        "suggestionText",
        "potentialSavings"
      ]
    },
    "Investment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Investment",
      "type": "object",
      "description": "Represents a user's investment portfolio.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the investment."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Investment)"
        },
        "name": {
          "type": "string",
          "description": "Name of the investment (e.g., Stocks, Bonds)."
        },
        "type": {
          "type": "string",
          "description": "Type of the investment (e.g., shares, mutual funds)."
        },
        "quantity": {
          "type": "number",
          "description": "Number of units/shares of the investment."
        },
        "purchasePrice": {
          "type": "number",
          "description": "Purchase price of each unit/share."
        },
        "currentValue": {
          "type": "number",
          "description": "Current market value of the investment."
        },
        "purchaseDate": {
          "type": "string",
          "description": "Date when the investment was made.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "type",
        "quantity",
        "purchasePrice",
        "purchaseDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information.  This path ensures that only the authenticated user (or an admin role, if implemented) can access or modify their profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user.  This is used to ensure path-based ownership of user data."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/incomes/{incomeId}",
        "definition": {
          "entityName": "Income",
          "schema": {
            "$ref": "#/backend/entities/Income"
          },
          "description": "Stores income entries for a specific user. Ensures that only the authenticated user can manage their income data. Uses path-based ownership. Denormalizes the 'userId' field within each document for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who owns this income entry."
            },
            {
              "name": "incomeId",
              "description": "The unique identifier for the income entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expense entries for a specific user. Ensures that only the authenticated user can manage their expense data. Uses path-based ownership. Denormalizes the 'userId' field within each document for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who owns this expense entry."
            },
            {
              "name": "expenseId",
              "description": "The unique identifier for the expense entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/budgetAlerts/{budgetId}",
        "definition": {
          "entityName": "BudgetAlert",
          "schema": {
            "$ref": "#/backend/entities/BudgetAlert"
          },
          "description": "Stores budget alerts for a specific user. Ensures that only the authenticated user can manage their budget alerts. Uses path-based ownership. Denormalizes the 'userId' field within each document for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who owns this budget alert."
            },
            {
              "name": "budgetId",
              "description": "The unique identifier for the budget alert."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/savingSuggestions/{suggestionId}",
        "definition": {
          "entityName": "SavingSuggestion",
          "schema": {
            "$ref": "#/backend/entities/SavingSuggestion"
          },
          "description": "Stores saving suggestions for a specific user. Ensures that only the authenticated user can access their saving suggestions. Uses path-based ownership. Denormalizes the 'userId' field within each document for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who owns this saving suggestion."
            },
            {
              "name": "suggestionId",
              "description": "The unique identifier for the saving suggestion."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/investments/{investmentId}",
        "definition": {
          "entityName": "Investment",
          "schema": {
            "$ref": "#/backend/entities/Investment"
          },
          "description": "Stores investment information for a specific user. Ensures that only the authenticated user can manage their investment data. Uses path-based ownership. Denormalizes the 'userId' field within each document for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who owns this investment."
            },
            {
              "name": "investmentId",
              "description": "The unique identifier for the investment."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to securely manage personal financial data for users. It leverages path-based ownership and structural segregation to simplify security rules and ensure data privacy. Each user's data (profile, income, expenses, budget alerts, saving suggestions, and investments) is stored under their unique user ID, enabling straightforward security rules based on `request.auth.uid`. This eliminates the need for complex authorization logic or `get()` calls within the security rules, enhancing performance and security. The structure facilitates secure `list` operations by ensuring that all documents within a collection share the same security requirements. This design promotes authorization independence, clarity of intent, and adheres to the DBAC principle by storing roles directly within the database, thus avoiding custom claims."
  }
}
{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user of the Finanzas Personales application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName"
      ]
    },
    "Income": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Income",
      "type": "object",
      "description": "Represents a user's income entry.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Income entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Income)"
        },
        "source": {
          "type": "string",
          "description": "Source of the income (e.g., salary, investment)."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the income."
        },
        "date": {
          "type": "string",
          "description": "Date of the income.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "source",
        "amount",
        "date"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents a user's expense entry.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Expense entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Expense)"
        },
        "category": {
          "type": "string",
          "description": "Category of the expense (e.g., vivienda, comida, transporte)."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the expense."
        },
        "date": {
          "type": "string",
          "description": "Date of the expense.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "category",
        "amount",
        "date"
      ]
    },
    "BudgetAlert": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "BudgetAlert",
      "type": "object",
      "description": "Represents a budget alert for a specific expense category.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the BudgetAlert entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N BudgetAlert)"
        },
        "category": {
          "type": "string",
          "description": "Expense category for the budget alert."
        },
        "limit": {
          "type": "number",
          "description": "Spending limit for the category."
        },
        "startDate": {
          "type": "string",
          "description": "Start date for monitoring the budget.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date for monitoring the budget.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "category",
        "limit",
        "startDate",
        "endDate"
      ]
    },
    "SavingSuggestion": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SavingSuggestion",
      "type": "object",
      "description": "Represents a personalized saving suggestion.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SavingSuggestion entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N SavingSuggestion)"
        },
        "suggestionText": {
          "type": "string",
          "description": "Text of the saving suggestion."
        },
        "potentialSavings": {
          "type": "number",
          "description": "Estimated potential savings from the suggestion."
        },
        "date": {
          "type": "string",
          "description": "Date when the suggestion was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "suggestionText",
        "potentialSavings",
        "date"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information.  This is the root path for all user-specific data.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/incomes/{incomeId}",
        "definition": {
          "entityName": "Income",
          "schema": {
            "$ref": "#/backend/entities/Income"
          },
          "description": "Stores income entries for a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "incomeId",
              "description": "Unique identifier for the income entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expense entries for a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "expenseId",
              "description": "Unique identifier for the expense entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/budgetAlerts/{alertId}",
        "definition": {
          "entityName": "BudgetAlert",
          "schema": {
            "$ref": "#/backend/entities/BudgetAlert"
          },
          "description": "Stores budget alerts for a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "alertId",
              "description": "Unique identifier for the budget alert."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/savingSuggestions/{suggestionId}",
        "definition": {
          "entityName": "SavingSuggestion",
          "schema": {
            "$ref": "#/backend/entities/SavingSuggestion"
          },
          "description": "Stores saving suggestions for a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "suggestionId",
              "description": "Unique identifier for the saving suggestion."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to manage personal finances for individual users, focusing on income, expenses, budget alerts, and savings suggestions. The structure prioritizes authorization independence and query performance. It leverages path-based ownership for user-specific data. Data for each user is stored under their unique user ID, enabling secure and efficient data access. This design supports the required QAPs (Rules are not Filters) by using structural segregation based on user ownership, eliminating the need for complex filtering within security rules and ensuring that list operations are inherently secure.\n\n**Authorization Independence:** Each entity is stored under the `/users/{userId}` path, ensuring that access control can be enforced solely based on the `request.auth.uid` matching the `userId` without needing to retrieve parent document data. For example, all `income`, `expenses`, `budgetAlerts`, and `savingSuggestions` are stored as subcollections of `/users/{userId}`, guaranteeing that security rules only need to check if `request.auth.uid == userId`.\n\n**QAPs (Rules are not Filters):** The path-based ownership model inherently supports secure list operations.  Since each user's data is segregated into their own document path, listing data under `/users/{userId}/incomes` only returns data accessible to that user, as enforced by the security rules."
  }
}
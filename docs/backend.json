{
  "entities": {
    "Income": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Income",
      "type": "object",
      "description": "Represents a single income entry for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the income entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who owns this income. (Relationship: User 1:N Income)"
        },
        "source": {
          "type": "string",
          "description": "The source of the income (e.g., salary, investment).",
          "format": "string"
        },
        "amount": {
          "type": "number",
          "description": "The amount of income received.",
          "format": "number"
        },
        "date": {
          "type": "string",
          "description": "The date the income was received.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "source",
        "amount",
        "date"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents a single expense entry for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who owns this expense. (Relationship: User 1:N Expense)"
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to the ExpenseCategory for this expense. (Relationship: ExpenseCategory 1:N Expense)"
        },
        "amount": {
          "type": "number",
          "description": "The amount of the expense.",
          "format": "number"
        },
        "date": {
          "type": "string",
          "description": "The date the expense was incurred.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the expense."
        }
      },
      "required": [
        "id",
        "userId",
        "categoryId",
        "amount",
        "date"
      ]
    },
    "ExpenseCategory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ExpenseCategory",
      "type": "object",
      "description": "Represents a category for expenses (e.g., food, housing, transportation).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense category."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who created this category. (Relationship: User 1:N ExpenseCategory)"
        },
        "name": {
          "type": "string",
          "description": "The name of the expense category (e.g., Food, Housing)."
        },
        "budgetLimit": {
          "type": "number",
          "description": "Optional budget limit for this category.",
          "format": "number"
        }
      },
      "required": [
        "id",
        "userId",
        "name"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "The user's display name."
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. This path serves as the root for all user-specific data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/incomes/{incomeId}",
        "definition": {
          "entityName": "Income",
          "schema": {
            "$ref": "#/backend/entities/Income"
          },
          "description": "Stores income entries for a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "incomeId",
              "description": "The unique identifier for the income entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expense entries for a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "expenseId",
              "description": "The unique identifier for the expense entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/expenseCategories/{categoryId}",
        "definition": {
          "entityName": "ExpenseCategory",
          "schema": {
            "$ref": "#/backend/entities/ExpenseCategory"
          },
          "description": "Stores expense categories for a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "categoryId",
              "description": "The unique identifier for the expense category."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage personal finance data for individual users. It leverages path-based ownership to ensure data privacy and simplifies security rules. Each user's data (income, expenses, and expense categories) is stored under their respective user ID, facilitating secure access control. This approach ensures Authorization Independence by eliminating the need for `get()` calls in security rules and enables atomic operations. Specifically, we are leveraging path based ownership which creates an implicit authorization context based on the user's `uid`. This enables QAPs because list operations can be secured based on the path. Each entity related to a User is nested under the `/users/{userId}` path which simplifies security rules and enforces data isolation. By organizing the data in this manner, we ensure that users can only access their own financial information. This approach avoids the complexity of managing shared data or complex role-based access control."
  }
}